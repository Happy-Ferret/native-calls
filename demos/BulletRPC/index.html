<html>
<!--
Copyright (c) 2013 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->
<head>
  <title>Bullet Physics Native Calls</title>
  <script src="../../scripts/paths.require.js"></script>
  <script type="text/javascript" src="data/three.min.js"></script>
  <script type="text/javascript" src="data/scene.js"></script>
  <script type="text/javascript" src="data/scenes.js"></script>

  <!-- stats -->
  <script type="text/javascript" src="data/json2.min.js"></script>
  <script type="text/javascript" src="data/jstorage.min.js"></script>
  <script type="text/javascript" src="data/stats.js"></script>

  <script src="../../scripts/lib/requirejs/require.js"></script>
  <!-- set window.NaClConfig -->
  <script type="text/javascript" src="../../scripts/urlParams.js"></script>
  <script>
    // some configuration
    window.NaClConfig.VALIDATION = false;
    requirejs.config({ baseUrl: '../../scripts', paths: REQUIRE_PATHS});
    var prefix = "/demos/BulletRPC/";

    require(['NativeCalls', prefix+'Bullet/BulletRPC.js'], function (NativeCalls, BulletRPC) {
        window.loglevel = NativeCalls.loglevel;
        window.bullet = BulletRPC(prefix);

        loglevel.disableAll();
        // load the module.
        NativeCalls.RPCModule.getModule(bullet).load(function(){
            NCStats.trips++;
            console.log("module loaded!");
            init();
            // load the scene then animate
            loadWorld(jengaScene(20), animate);
        });

        $.jStorage.subscribe("bench-command", function(channel, payload){
          if(payload == "start"){
            startPublishingStats("sync-stats");
            return;
          }
          fn = window[payload];
          if(typeof fn == "function"){
            fn();
          }
        });

    });
  </script>
</head>
<body>
  <h1>Bullet Physics</h1>
  <div id="config">
    <select id="scene">
      <option value="jenga10">Block Tower (10 blocks)</option>
      <option value="jenga20" selected>Block Tower (20 blocks)</option>
      <option value="randomShapes">Random Shapes</option>
      <option value="randomCube250">Random Cubes (250)</option>
      <option value="randomCylinder500">Random Cylinders (500)</option>
      <option value="randomCube1000">Random Cubes (1000)</option>
      <option value="randomCube2000">Random Cubes (2000)</option>
    </select>
    <button id="reload">Reload Scene</button>
  </div>
  <a href="bench.html" target="_blank">Performance (right click and open in new window)</a>
  <ul>
    <li>Click and drag an object to move it</li>
    <li>Click and drag elsewhere to rotate the camera</li>
    <li>Use the mousewheel to zoom in/out</li>
  </ul>
  <div id="rendererContainer" style="position: static; width: 512px; height: 512px"></div>
  <p>
    More info about Bullet Physics can be found at <a
    href="http://bulletphysics.org/">http://bulletphysics.org</a>.
  </p>
  <p>
    This demo was implemented by <a
      href="http://www.johnmccutchan.com">John McCutchan</a>.  Read his
    blog post about Native Client acceleration modules <a
      href="http://www.johnmccutchan.com/2012/10/bullet-native-client-acceleration-module.html">here</a>,
    and see the source for this demo <a
      href="https://github.com/binji/NaClAMBase">here</a>.
  </p>
  <p>
    Simulation time: <span id="simulationTime">0</span>&mu;s.
  </p>
  <div id="listener"></div>
</body>
</html>
