include $(NACL_SDK_ROOT)/tools/common.mk

CFLAGS = -Wall -Wno-strict-aliasing

all: install

# Build rules generated by macros from common.mk:
#

# NaClRPCInstance [legacy]
TARGET := NaClRPCInstance
SOURCES := NaClRPCInstance.cpp
$(foreach src,$(SOURCES),$(eval $(call COMPILE_RULE,$(src),$(CFLAGS))))
$(eval $(call LIB_RULE,$(TARGET),$(SOURCES)))

ifeq ($(TOOLCHAIN),glibc)
$(eval $(call SO_RULE,$(TARGET),$(SOURCES)))
endif

# RPCRequest
$(foreach src,RPCRequest.cpp,$(eval $(call COMPILE_RULE,$(src),$(CFLAGS))))
$(eval $(call LIB_RULE,RPCRequest,RPCRequest.cpp))

ifeq ($(TOOLCHAIN),glibc)
$(eval $(call SO_RULE,RPCRequest,RPCRequest.cpp))
endif

# RPCTransport
$(foreach src,RPCTransport.cpp,$(eval $(call COMPILE_RULE,$(src),$(CFLAGS))))
$(eval $(call LIB_RULE,RPCTransport,RPCTransport.cpp))

ifeq ($(TOOLCHAIN),glibc)
$(eval $(call SO_RULE,RPCTransport,RPCTransport.cpp))
endif

# JSONRPC
$(foreach src,JSONRPC.cpp,$(eval $(call COMPILE_RULE,$(src),$(CFLAGS))))
$(eval $(call LIB_RULE,JSONRPC,JSONRPC.cpp))

ifeq ($(TOOLCHAIN),glibc)
$(eval $(call SO_RULE,JSONRPC,JSONRPC.cpp))
endif

#RPCRuntime
$(foreach src,RPCRuntime.cpp,$(eval $(call COMPILE_RULE,$(src),$(CFLAGS))))
$(eval $(call LIB_RULE,RPCRuntime,RPCRuntime.cpp))

ifeq ($(TOOLCHAIN),glibc)
$(eval $(call SO_RULE,RPCRuntime,RPCRuntime.cpp))
endif

#RPCType
$(foreach src,RPCType.cpp,$(eval $(call COMPILE_RULE,$(src),$(CFLAGS))))
$(eval $(call LIB_RULE,RPCType,RPCType.cpp))

ifeq ($(TOOLCHAIN),glibc)
$(eval $(call SO_RULE,RPCType,RPCType.cpp))
endif
